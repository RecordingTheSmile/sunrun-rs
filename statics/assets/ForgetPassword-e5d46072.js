import{e as U,r as m,f as q,g as z,l as E,h as D,c as N,a as v,b as a,w as s,F as V,m as d,p as j,i as $,o as I,j as H,k as L,d as w,t as M}from"./index-b65b5484.js";import{F as R,_ as A}from"./index-45abc488.js";import{I as G}from"./index-829d9efa.js";import{_ as J}from"./index-ae0f4775.js";import{r as k}from"./index-c9997867.js";import{_ as K}from"./ImgCaptcha.vue_vue_type_script_setup_true_lang-17ea1ebb.js";import{_ as O}from"./index-9c362c9d.js";import{B as Q}from"./index-3d98cbd4.js";import{_ as W}from"./_plugin-vue_export-helper-8f6a5dc0.js";import"./collapseMotion-09a61311.js";import"./useFlexGapSupport-9980977a.js";import"./useSize-9ecf35dc.js";import"./index-2f61141a.js";import"./index-3971b52c.js";import"./index-e0a5ed5c.js";import"./useMergedState-efc27634.js";import"./ActionButton-974fa8a9.js";import"./css-aae66f86.js";const X=c=>(j("data-v-8f785781"),c=c(),$(),c),Y={class:"outer"},Z={class:"main"},ee={class:"form-container"},ae=X(()=>v("h1",{style:{"text-align":"center","margin-bottom":"40px","padding-top":"20px"}},"忘记密码",-1)),oe=U({__name:"ForgetPassword",setup(c){const i=m(""),r=m(!1),o=q({username:"",password:"",passwordTwice:"",email:"",code:""}),C=z(),F=l=>{if(l.password!==l.passwordTwice){i.value="两次密码输入不一致";return}return r.value=!0,i.value="",k.post("/user/api/forgetPassword",l).then(e=>{if(!e.data.success){i.value=e.data.message??"重置密码失败，请重试";return}d.success("密码重置成功"),C.push({name:"login"})}).catch(e=>{var f;i.value=((f=e.response)==null?void 0:f.data).message??"网络错误，请重试"}).finally(()=>{r.value=!1})},S=(l,e)=>/(.+)@(.+)\.(.+)/.test(e)?Promise.resolve():Promise.reject("邮箱格式不正确"),n=m(0),_=m(""),g=m(!1);let p=-1;const T=()=>{n.value===0&&(clearInterval(p),p=-1),n.value--},h=()=>{if(!/(.+)@(.+)\.(.+)/.test(o.email)){d.error("邮箱格式不正确");return}if(_.value===""){g.value=!0;return}return r.value=!0,n.value=0,k.post("/public/api/sendEmailCode",{captcha:_.value,email:o.email}).then(l=>{l.data.success?(d.success("邮件发送成功，请查收"),n.value=30,p=setInterval(T,1e3)):d.error(l.data.message??"邮件发送失败，请重试")}).catch(l=>{console.error(l),d.error("网络错误，请重试")}).finally(()=>{_.value="",r.value=!1})};return E(()=>{p!==-1&&clearInterval(p)}),(l,e)=>{const f=J,y=G,u=A,b=Q,x=O,B=D("router-link"),P=R;return I(),N(V,null,[v("div",Y,[v("div",Z,[v("div",ee,[ae,a(P,{"label-col":{style:{width:"8em"}},class:"user-layout-login",model:o,autocomplete:!1,onFinish:F},{default:s(()=>[i.value!==""?(I(),H(f,{key:0,type:"error",showIcon:"",style:{"margin-bottom":"24px"},message:i.value},null,8,["message"])):L("",!0),a(u,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱"},{validator:S}]},{default:s(()=>[a(y,{size:"large",placeholder:"请输入邮箱",value:o.email,"onUpdate:value":e[0]||(e[0]=t=>o.email=t),type:"email"},null,8,["value"])]),_:1},8,["rules"]),a(u,null,{default:s(()=>[a(b,{type:"primary",style:{float:"right"},onClick:h,loading:r.value,disabled:n.value>0},{default:s(()=>[w(M(n.value>0?`${n.value}秒后重新发送`:"发送邮箱验证码"),1)]),_:1},8,["loading","disabled"])]),_:1}),a(u,{label:"邮箱验证码",name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:s(()=>[a(y,{size:"large",value:o.code,"onUpdate:value":e[1]||(e[1]=t=>o.code=t),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),a(u,{label:"新密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:s(()=>[a(x,{size:"large",placeholder:"请输入密码",value:o.password,"onUpdate:value":e[2]||(e[2]=t=>o.password=t)},null,8,["value"])]),_:1}),a(u,{label:"确认新密码",name:"passwordTwice",rules:[{required:!0,message:"请输入密码"}]},{default:s(()=>[a(x,{size:"large",placeholder:"请再次输入密码",value:o.passwordTwice,"onUpdate:value":e[3]||(e[3]=t=>o.passwordTwice=t)},null,8,["value"])]),_:1}),a(u,{style:{"margin-top":"24px"}},{default:s(()=>[a(b,{size:"large",type:"primary",htmlType:"submit",class:"login-button",loading:r.value,disabled:r.value},{default:s(()=>[w("提交")]),_:1},8,["loading","disabled"])]),_:1}),a(u,null,{default:s(()=>[a(B,{style:{float:"left"},type:"link",to:{name:"login"}},{default:s(()=>[w("← 去登录")]),_:1})]),_:1})]),_:1},8,["model"])])])]),a(K,{"is-show":g.value,"onUpdate:isShow":e[4]||(e[4]=t=>g.value=t),onComplete:e[5]||(e[5]=t=>{_.value=t,h()})},null,8,["is-show"])],64)}}});const be=W(oe,[["__scopeId","data-v-8f785781"]]);export{be as default};
