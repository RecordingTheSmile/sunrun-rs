import{e as z,r as _,n as $,c as k,a as m,b as r,w as c,m as i,o as u,d as p,j as y,F as B,t as D,k as M}from"./index-b65b5484.js";import{b as N,c as T}from"./index-fd6eec2a.js";import"./index-a2b98079.js";import"./index-3971b52c.js";import"./index-829d9efa.js";import{_ as V}from"./index-a500ebeb.js";import{_ as U}from"./index-42da564f.js";import{_ as F}from"./index-c4c5f765.js";import{r as g}from"./index-c9997867.js";import{B as j}from"./index-3d98cbd4.js";import{_ as q}from"./_plugin-vue_export-helper-8f6a5dc0.js";import"./useMergedState-efc27634.js";import"./ActionButton-974fa8a9.js";import"./eagerComputed-85e21e12.js";import"./collapseMotion-09a61311.js";import"./css-aae66f86.js";import"./index-9c362c9d.js";import"./useFlexGapSupport-9980977a.js";const E={class:"table-container"},G={style:{width:"100%","text-align":"center"}},H={style:{width:"100%"},class:"table-opr"},J={style:{width:"100%"}},K=z({__name:"UserManage",setup(O){const x=[{dataIndex:"id",key:"id",title:"用户ID"},{dataIndex:"username",key:"username",title:"用户名"},{dataIndex:"email",key:"email",title:"邮箱"},{dataIndex:"canLogin",key:"canLogin",title:"可否登录"},{dataIndex:"isAdmin",key:"isAdmin",title:"是否为管理员"},{dataIndex:"createAt",key:"createAt",title:"创建于"}],f=_(),t=_(!1),a=_({current:1,pageSize:50,total:0}),A=(n,o,e)=>{l(n.current??1,n.pageSize??50)},l=(n,o)=>(t.value=!0,g.get("/admin/api/user",{params:{page:n,limit:o}}).then(e=>{e.data.success?(f.value=e.data.data.rows,a.value.total=e.data.data.total):i.error(e.data.message??"获取数据失败，请刷新表格重试")}).catch(e=>{console.error(e),i.error("网路错误，请刷新表格重试")}).finally(()=>{t.value=!1})),C=(n,o)=>(t.value=!0,g.put(`/admin/api/user/${n}/loginStatus`,{canLogin:!o}).then(e=>{if(t.value=!1,e.data.success)return i.success("提交成功"),l(a.value.current,a.value.pageSize);i.error(e.data.message??"提交数据失败，请重试")}).catch(e=>{t.value=!1,console.error(e),i.error("网络错误，请重试")})),I=(n,o)=>(t.value=!0,g.put(`/admin/api/user/${n}/isAdmin`,{isAdmin:!o}).then(e=>{if(t.value=!1,e.data.success)return i.success("提交成功"),l(a.value.current,a.value.pageSize);i.error(e.data.message??"提交数据失败，请重试")}).catch(e=>{t.value=!1,console.error(e),i.error("网络错误，请重试")}));return $(()=>{l(a.value.current,a.value.pageSize)}),(n,o)=>{const e=F,L=j,S=U,h=V,v=T,b=N;return u(),k("div",E,[m("div",G,[r(e,{level:3},{default:c(()=>[p("平台用户管理")]),_:1})]),m("div",H,[r(S,{size:8},{default:c(()=>[r(L,{type:"primary",loading:t.value,onClick:o[0]||(o[0]=d=>l(a.value.current,a.value.pageSize))},{default:c(()=>[p("刷新表格")]),_:1},8,["loading"])]),_:1})]),m("div",J,[r(b,{loading:t.value,columns:x,"data-source":f.value,scroll:{x:!0},pagination:a.value,onChange:A},{bodyCell:c(({column:d,record:s})=>[d.key==="canLogin"?(u(),y(v,{key:0,title:`您确定要${s.canLogin?"禁止":"允许"}用户登录吗？`,"ok-text":"确认","cancel-text":"取消",onConfirm:w=>C(s.id,s.canLogin)},{default:c(()=>[r(h,{checked:s.canLogin,"checked-children":"可登录","un-checked-children":"不可登录"},null,8,["checked"])]),_:2},1032,["title","onConfirm"])):d.key==="isAdmin"?(u(),y(v,{key:1,title:`您确定要${s.isAdmin?"取消":"授予"}用户管理员资格吗？`,"ok-text":"确认","cancel-text":"取消",onConfirm:w=>I(s.id,s.isAdmin)},{default:c(()=>[r(h,{checked:s.isAdmin,"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:2},1032,["title","onConfirm"])):d.key==="createAt"?(u(),k(B,{key:2},[p(D(new Date(s.createAt*1e3).toLocaleString()),1)],64)):M("",!0)]),_:1},8,["loading","data-source","pagination"])])])}}});const ue=q(K,[["__scopeId","data-v-156819d6"]]);export{ue as default};
