import{e as U,r as d,f as q,g as z,l as E,h as D,o as I,c as N,a as f,b as a,w as s,i as V,j,d as w,t as $,F as H,m,B as L,p as M,k as R}from"./index-ead633b2.js";import{_ as A,F as G}from"./index-5cb42d46.js";import{I as J}from"./index-88f2ff4c.js";import{_ as K}from"./index-4b0dfc7e.js";import{r as k}from"./index-c4ebfd02.js";import{_ as O}from"./ImgCaptcha.vue_vue_type_script_setup_true_lang-96a4328d.js";import{_ as Q}from"./index-6e6a2308.js";import{_ as W}from"./_plugin-vue_export-helper-c27b6911.js";import"./collapseMotion-090e2670.js";import"./useFlexGapSupport-e64096c7.js";import"./useSize-108b0685.js";import"./index-0fd9cccf.js";import"./index-71caf399.js";import"./css-aae66f86.js";import"./useMergedState-426bca96.js";import"./LeftOutlined-91b2dd16.js";const X=c=>(M("data-v-8f785781"),c=c(),R(),c),Y={class:"outer"},Z={class:"main"},ee={class:"form-container"},ae=X(()=>f("h1",{style:{"text-align":"center","margin-bottom":"40px","padding-top":"20px"}},"忘记密码",-1)),te=U({__name:"ForgetPassword",setup(c){const i=d(""),r=d(!1),t=q({username:"",password:"",passwordTwice:"",email:"",code:""}),C=z(),F=l=>{if(l.password!==l.passwordTwice){i.value="两次密码输入不一致";return}return r.value=!0,i.value="",k.post("/user/api/forgetPassword",l).then(e=>{if(!e.data.success){i.value=e.data.message??"重置密码失败，请重试";return}m.success("密码重置成功"),C.push({name:"login"})}).catch(e=>{var v;i.value=((v=e.response)==null?void 0:v.data).message??"网络错误，请重试"}).finally(()=>{r.value=!1})},S=(l,e)=>/(.+)@(.+)\.(.+)/.test(e)?Promise.resolve():Promise.reject("邮箱格式不正确"),n=d(0),_=d(""),g=d(!1);let p=-1;const T=()=>{n.value===0&&(clearInterval(p),p=-1),n.value--},h=()=>{if(!/(.+)@(.+)\.(.+)/.test(t.email)){m.error("邮箱格式不正确");return}if(_.value===""){g.value=!0;return}return r.value=!0,n.value=0,k.post("/public/api/sendEmailCode",{captcha:_.value,email:t.email}).then(l=>{l.data.success?(m.success("邮件发送成功，请查收"),n.value=30,p=setInterval(T,1e3)):m.error(l.data.message??"邮件发送失败，请重试")}).catch(l=>{console.error(l),m.error("网络错误，请重试")}).finally(()=>{_.value="",r.value=!1})};return E(()=>{p!==-1&&clearInterval(p)}),(l,e)=>{const v=K,y=J,u=A,b=L,x=Q,B=D("router-link"),P=G;return I(),N(H,null,[f("div",Y,[f("div",Z,[f("div",ee,[ae,a(P,{"label-col":{style:{width:"8em"}},class:"user-layout-login",model:t,autocomplete:!1,onFinish:F},{default:s(()=>[i.value!==""?(I(),V(v,{key:0,type:"error",showIcon:"",style:{"margin-bottom":"24px"},message:i.value},null,8,["message"])):j("",!0),a(u,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱"},{validator:S}]},{default:s(()=>[a(y,{size:"large",placeholder:"请输入邮箱",value:t.email,"onUpdate:value":e[0]||(e[0]=o=>t.email=o),type:"email"},null,8,["value"])]),_:1},8,["rules"]),a(u,null,{default:s(()=>[a(b,{type:"primary",style:{float:"right"},onClick:h,loading:r.value,disabled:n.value>0},{default:s(()=>[w($(n.value>0?`${n.value}秒后重新发送`:"发送邮箱验证码"),1)]),_:1},8,["loading","disabled"])]),_:1}),a(u,{label:"邮箱验证码",name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:s(()=>[a(y,{size:"large",value:t.code,"onUpdate:value":e[1]||(e[1]=o=>t.code=o),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),a(u,{label:"新密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:s(()=>[a(x,{size:"large",placeholder:"请输入密码",value:t.password,"onUpdate:value":e[2]||(e[2]=o=>t.password=o)},null,8,["value"])]),_:1}),a(u,{label:"确认新密码",name:"passwordTwice",rules:[{required:!0,message:"请输入密码"}]},{default:s(()=>[a(x,{size:"large",placeholder:"请再次输入密码",value:t.passwordTwice,"onUpdate:value":e[3]||(e[3]=o=>t.passwordTwice=o)},null,8,["value"])]),_:1}),a(u,{style:{"margin-top":"24px"}},{default:s(()=>[a(b,{size:"large",type:"primary",htmlType:"submit",class:"login-button",loading:r.value,disabled:r.value},{default:s(()=>[w("提交")]),_:1},8,["loading","disabled"])]),_:1}),a(u,null,{default:s(()=>[a(B,{style:{float:"left"},type:"link",to:{name:"login"}},{default:s(()=>[w("← 去登录")]),_:1})]),_:1})]),_:1},8,["model"])])])]),a(O,{"is-show":g.value,"onUpdate:isShow":e[4]||(e[4]=o=>g.value=o),onComplete:e[5]||(e[5]=o=>{_.value=o,h()})},null,8,["is-show"])],64)}}});const he=W(te,[["__scopeId","data-v-8f785781"]]);export{he as default};
