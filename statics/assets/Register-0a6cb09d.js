import{e as B,r as p,f as F,g as E,l as D,h as N,c as R,a as v,b as a,w as o,F as V,m as d,p as j,i as P,o as I,j as $,k as H,d as y,t as L}from"./index-b65b5484.js";import{F as M,_ as A}from"./index-45abc488.js";import{I as G}from"./index-829d9efa.js";import{_ as J}from"./index-ae0f4775.js";import{r as k}from"./index-c9997867.js";import{_ as K}from"./ImgCaptcha.vue_vue_type_script_setup_true_lang-17ea1ebb.js";import{_ as O}from"./index-9c362c9d.js";import{B as Q}from"./index-3d98cbd4.js";import{_ as W}from"./_plugin-vue_export-helper-8f6a5dc0.js";import"./collapseMotion-09a61311.js";import"./useFlexGapSupport-9980977a.js";import"./useSize-9ecf35dc.js";import"./index-2f61141a.js";import"./index-3971b52c.js";import"./index-e0a5ed5c.js";import"./useMergedState-efc27634.js";import"./ActionButton-974fa8a9.js";import"./css-aae66f86.js";const X=c=>(j("data-v-9bf941af"),c=c(),P(),c),Y={class:"outer"},Z={class:"main"},ee={class:"form-container"},ae=X(()=>v("h1",{style:{"text-align":"center","margin-bottom":"40px","padding-top":"20px"}},"注册",-1)),te=B({__name:"Register",setup(c){const i=p(""),n=p(!1),t=F({username:"",password:"",passwordTwice:"",email:"",code:""}),C=E(),S=l=>{if(l.password!==l.passwordTwice){i.value="两次密码输入不一致";return}return n.value=!0,i.value="",k.post("/user/api/register",l).then(e=>{if(!e.data.success){i.value=e.data.message??"注册失败，请重试";return}d.success("注册成功"),C.push({name:"login"})}).catch(e=>{var f;i.value=((f=e.response)==null?void 0:f.data).message??"网络错误，请重试"}).finally(()=>{n.value=!1})},T=(l,e)=>/(.+)@(.+)\.(.+)/.test(e)?Promise.resolve():Promise.reject("邮箱格式不正确"),u=p(0),_=p(""),g=p(!1);let m=-1;const U=()=>{u.value===0&&(clearInterval(m),m=-1),u.value--},b=()=>{if(!/(.+)@(.+)\.(.+)/.test(t.email)){d.error("邮箱格式不正确");return}if(_.value===""){g.value=!0;return}return n.value=!0,u.value=0,k.post("/public/api/sendEmailCode",{captcha:_.value,email:t.email}).then(l=>{l.data.success?(d.success("邮件发送成功，请查收"),u.value=30,m=setInterval(U,1e3)):d.error(l.data.message??"邮件发送失败，请重试")}).catch(l=>{console.error(l),d.error("网络错误，请重试")}).finally(()=>{_.value="",n.value=!1})};return D(()=>{m!==-1&&clearInterval(m)}),(l,e)=>{const f=J,w=G,r=A,h=O,x=Q,q=N("router-link"),z=M;return I(),R(V,null,[v("div",Y,[v("div",Z,[v("div",ee,[ae,a(z,{"label-col":{style:{width:"8em"}},class:"user-layout-login",model:t,autocomplete:!1,onFinish:S},{default:o(()=>[i.value!==""?(I(),$(f,{key:0,type:"error",showIcon:"",style:{"margin-bottom":"24px"},message:i.value},null,8,["message"])):H("",!0),a(r,{rules:[{required:!0,message:"请输入用户名"}],label:"用户名",name:"username"},{default:o(()=>[a(w,{value:t.username,"onUpdate:value":e[0]||(e[0]=s=>t.username=s),size:"large",type:"text",placeholder:"请输入用户名",rules:[]},null,8,["value"])]),_:1}),a(r,{label:"密码",name:"password",rules:[{required:!0,message:"请输入密码"}]},{default:o(()=>[a(h,{size:"large",placeholder:"请输入密码",value:t.password,"onUpdate:value":e[1]||(e[1]=s=>t.password=s)},null,8,["value"])]),_:1}),a(r,{label:"确认密码",name:"passwordTwice",rules:[{required:!0,message:"请输入密码"}]},{default:o(()=>[a(h,{size:"large",placeholder:"请再次输入密码",value:t.passwordTwice,"onUpdate:value":e[2]||(e[2]=s=>t.passwordTwice=s)},null,8,["value"])]),_:1}),a(r,{label:"邮箱",name:"email",rules:[{required:!0,message:"请输入邮箱"},{validator:T}]},{default:o(()=>[a(w,{size:"large",placeholder:"请输入邮箱",value:t.email,"onUpdate:value":e[3]||(e[3]=s=>t.email=s),type:"email"},null,8,["value"])]),_:1},8,["rules"]),a(r,null,{default:o(()=>[a(x,{type:"primary",style:{float:"right"},onClick:b,loading:n.value,disabled:u.value>0},{default:o(()=>[y(L(u.value>0?`${u.value}秒后重新发送`:"发送邮箱验证码"),1)]),_:1},8,["loading","disabled"])]),_:1}),a(r,{label:"邮箱验证码",name:"code",rules:[{required:!0,message:"请输入验证码"}]},{default:o(()=>[a(w,{size:"large",value:t.code,"onUpdate:value":e[4]||(e[4]=s=>t.code=s),placeholder:"请输入邮箱验证码"},null,8,["value"])]),_:1}),a(r,{style:{"margin-top":"24px"}},{default:o(()=>[a(x,{size:"large",type:"primary",htmlType:"submit",class:"login-button",loading:n.value,disabled:n.value},{default:o(()=>[y("注册")]),_:1},8,["loading","disabled"])]),_:1}),a(r,null,{default:o(()=>[a(q,{style:{float:"left"},type:"link",to:{name:"login"}},{default:o(()=>[y("← 去登录")]),_:1})]),_:1})]),_:1},8,["model"])])])]),a(K,{"is-show":g.value,"onUpdate:isShow":e[5]||(e[5]=s=>g.value=s),onComplete:e[6]||(e[6]=s=>{_.value=s,b()})},null,8,["is-show"])],64)}}});const he=W(te,[["__scopeId","data-v-9bf941af"]]);export{he as default};
