import{e as w,r as _,n as $,o as d,c as k,a as m,b as r,w as c,d as p,i as y,F as B,t as D,j as M,m as i,B as N}from"./index-909aa435.js";import{b as T,c as V}from"./index-b8a8087c.js";import"./index-47abcfb5.js";import"./index-8dcb9358.js";import"./index-4032f88a.js";import{_ as U}from"./index-d9f5c39d.js";import{_ as F}from"./index-337c7bc7.js";import{_ as j}from"./index-d7643e3a.js";import{r as g}from"./index-1c416c28.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";import"./useMergedState-d21d9f59.js";import"./eagerComputed-87287b3f.js";import"./collapseMotion-8a201457.js";import"./css-aae66f86.js";import"./LeftOutlined-230a662a.js";import"./index-00087555.js";import"./useFlexGapSupport-de55b98d.js";const E={class:"table-container"},O={style:{width:"100%","text-align":"center"}},G={style:{width:"100%"},class:"table-opr"},H={style:{width:"100%"}},J=w({__name:"UserManage",setup(K){const x=[{dataIndex:"id",key:"id",title:"用户ID"},{dataIndex:"username",key:"username",title:"用户名"},{dataIndex:"email",key:"email",title:"邮箱"},{dataIndex:"canLogin",key:"canLogin",title:"可否登录"},{dataIndex:"isAdmin",key:"isAdmin",title:"是否为管理员"},{dataIndex:"createAt",key:"createAt",title:"创建于"}],f=_(),n=_(!1),t=_({current:1,pageSize:10,total:0,pageSizeOptions:["10","20","30","40","50"]}),A=(a,o,e)=>{t.value.pageSize=a.pageSize??10,t.value.current=a.current??1,l(a.current??1,a.pageSize??10)},l=(a,o)=>(n.value=!0,g.get("/admin/api/user",{params:{page:a,limit:o}}).then(e=>{e.data.success?(f.value=e.data.data.rows,t.value.total=e.data.data.total):i.error(e.data.message??"获取数据失败，请刷新表格重试")}).catch(e=>{console.error(e),i.error("网路错误，请刷新表格重试")}).finally(()=>{n.value=!1})),S=(a,o)=>(n.value=!0,g.put(`/admin/api/user/${a}/loginStatus`,{canLogin:!o}).then(e=>{if(n.value=!1,e.data.success)return i.success("提交成功"),l(t.value.current,t.value.pageSize);i.error(e.data.message??"提交数据失败，请重试")}).catch(e=>{n.value=!1,console.error(e),i.error("网络错误，请重试")})),C=(a,o)=>(n.value=!0,g.put(`/admin/api/user/${a}/isAdmin`,{isAdmin:!o}).then(e=>{if(n.value=!1,e.data.success)return i.success("提交成功"),l(t.value.current,t.value.pageSize);i.error(e.data.message??"提交数据失败，请重试")}).catch(e=>{n.value=!1,console.error(e),i.error("网络错误，请重试")}));return $(()=>{l(t.value.current,t.value.pageSize)}),(a,o)=>{const e=j,z=N,I=F,v=U,h=T,L=V;return d(),k("div",E,[m("div",O,[r(e,{level:3},{default:c(()=>[p("平台用户管理")]),_:1})]),m("div",G,[r(I,{size:8},{default:c(()=>[r(z,{type:"primary",loading:n.value,onClick:o[0]||(o[0]=u=>l(t.value.current,t.value.pageSize))},{default:c(()=>[p("刷新表格")]),_:1},8,["loading"])]),_:1})]),m("div",H,[r(L,{loading:n.value,columns:x,"data-source":f.value,scroll:{x:!0},pagination:t.value,onChange:A},{bodyCell:c(({column:u,record:s})=>[u.key==="canLogin"?(d(),y(h,{key:0,title:`您确定要${s.canLogin?"禁止":"允许"}用户登录吗？`,"ok-text":"确认","cancel-text":"取消",onConfirm:b=>S(s.id,s.canLogin)},{default:c(()=>[r(v,{checked:s.canLogin,"checked-children":"可登录","un-checked-children":"不可登录"},null,8,["checked"])]),_:2},1032,["title","onConfirm"])):u.key==="isAdmin"?(d(),y(h,{key:1,title:`您确定要${s.isAdmin?"取消":"授予"}用户管理员资格吗？`,"ok-text":"确认","cancel-text":"取消",onConfirm:b=>C(s.id,s.isAdmin)},{default:c(()=>[r(v,{checked:s.isAdmin,"checked-children":"是","un-checked-children":"否"},null,8,["checked"])]),_:2},1032,["title","onConfirm"])):u.key==="createAt"?(d(),k(B,{key:2},[p(D(new Date(s.createAt*1e3).toLocaleString()),1)],64)):M("",!0)]),_:1},8,["loading","data-source","pagination"])])])}}});const ue=q(J,[["__scopeId","data-v-e8f93811"]]);export{ue as default};
